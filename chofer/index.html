function initMap() {
    directionsService = new google.maps.DirectionsService();
    directionsRenderer = new google.maps.DirectionsRenderer({
        polylineOptions: { strokeColor: "#00c853", strokeWeight: 5 },
        suppressMarkers: false // Esto permite que Google ponga sus propios marcadores de A y B
    });

    if(navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
            const myPos = { lat: pos.coords.latitude, lng: pos.coords.longitude };
            
            // MAPA CON MÁS DETALLE
            map = new google.maps.Map(document.getElementById("map"), {
                center: myPos,
                zoom: 17, // Aumentamos el zoom para ver mejor las calles
                disableDefaultUI: false, // Dejamos los controles de zoom por si acaso
                mapId: "DEMO_MAP_ID" // Esto ayuda a que cargue mejor el estilo
            });
            
            directionsRenderer.setMap(map);

            // Marcador del Chofer (Un punto azul o un auto)
            userMarker = new google.maps.Marker({
                position: myPos,
                map: map,
                title: "Tu ubicación",
                icon: {
                    url: "https://maps.google.com/mapfiles/ms/icons/blue-dot.png" // Punto azul clásico de GPS
                }
            });
            
            buscarViajes();
        }, () => {
            alert("Por favor, activa el GPS para que el mapa cargue correctamente.");
        });
    }
}
