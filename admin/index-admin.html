<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Control Smart - Saladillo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body{ margin:0; font-family:Arial, sans-serif; background:#000; color:#fff; }
  header{ background:#111; padding:15px; border-bottom:2px solid #00c853; display:flex; justify-content:space-between; align-items:center; }
  .container{ padding:15px; }
  .grid{ display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
  @media(max-width:768px){ .grid{ grid-template-columns: 1fr; } }
  
  .card-admin{ background:#111; border:1px solid #333; border-radius:12px; padding:15px; margin-bottom:15px; }
  .chofer-row{ display:flex; justify-content:space-between; align-items:center; padding:10px; border-bottom:1px solid #222; }
  .chofer-row:last-child{ border:0; }
  
  h3{ color:#00c853; margin-top:0; font-size:16px; text-transform:uppercase; letter-spacing:1px; }
  .nombre{ font-weight:bold; color:#fff; display:block; }
  .tel{ font-size:12px; color:#888; }
  
  .badge{ padding:4px 8px; border-radius:5px; font-size:10px; font-weight:bold; }
  .status-disponible{ background:rgba(0,200,83,0.2); color:#00c853; }
  .status-ocupado{ background:rgba(255,82,82,0.2); color:#ff5252; }
  
  button{ padding:8px 12px; border:none; border-radius:6px; font-weight:bold; cursor:pointer; font-size:11px; }
  .btn-activar{ background:#ffb300; color:#000; }
  .btn-salir{ background:transparent; color:#ff5252; border:1px solid #ff5252; }
  
  .monitor-viajes{ background:#111; border:1px solid #00c853; border-radius:12px; padding:15px; }
</style>
</head>
<body>

<header>
  <div style="display:flex; align-items:center; gap:10px;">
    <img src="/file_000000008fd0720eb71af76359ccb359.png" width="30">
    <h2 style="margin:0; font-size:18px;">Control Smart</h2>
  </div>
  <button class="btn-salir" onclick="cerrarSesionAdmin()">SALIR</button>
</header>

<div class="container">
    <div class="grid">
        <div class="card-admin">
            <h3>Choferes en L칤nea</h3>
            <div id="listaEnVivo">
                <p style="color:#444;">Buscando se침al en Saladillo...</p>
            </div>
        </div>

        <div class="monitor-viajes">
            <h3>Pedidos de Viaje</h3>
            <div id="listaPedidos">
                <p style="color:#444;">No hay pedidos ahora.</p>
            </div>
        </div>
    </div>

    <div class="card-admin" style="margin-top:15px;">
        <h3>Administraci칩n de Cuentas</h3>
        <div id="gestionCuentas">
            </div>
    </div>
</div>

<script>
/* SEGURIDAD B츼SICA */
if(localStorage.getItem("adminAuth") !== "true"){
    // Descomentar esto cuando tengas el login-admin.html listo
    // location.href = "login-admin.html";
}

function cerrarSesionAdmin(){
    localStorage.removeItem("adminAuth");
    location.reload();
}

/* L칍GICA DE MONITOREO REAL */
function actualizarPanel() {
    // 1. Obtener Choferes en l칤nea desde el servidor
    fetch("/obtener-choferes-activos")
    .then(r => r.json())
    .then(choferes => {
        const div = document.getElementById("listaEnVivo");
        div.innerHTML = "";
        choferes.forEach(c => {
            const row = document.createElement("div");
            row.className = "chofer-row";
            row.innerHTML = `
                <div>
                    <span class="nombre">${c.telefono}</span>
                    <span class="tel">Lat: ${c.lat.toFixed(4)} | Lng: ${c.lng.toFixed(4)}</span>
                </div>
                <span class="badge status-${c.estado}">${c.estado.toUpperCase()}</span>
            `;
            div.appendChild(row);
        });
    });

    // 2. Obtener pedidos activos
    fetch("/verificar-pedidos")
    .then(r => r.json())
    .then(viaje => {
        const div = document.getElementById("listaPedidos");
        if(viaje && viaje.activo) {
            div.innerHTML = `
                <div style="background:#222; padding:10px; border-radius:8px; border-left:4px solid #ffb300;">
                    <p style="margin:0; font-weight:bold;">游늸 De: ${viaje.origen}</p>
                    <p style="margin:5px 0 0 0; font-size:12px; color:#aaa;">游끠 A: ${viaje.destino}</p>
                    <p style="margin:5px 0 0 0; color:#ffb300; font-weight:bold;">${viaje.precio}</p>
                </div>
            `;
        } else {
            div.innerHTML = "<p style='color:#444;'>Sin actividad reciente.</p>";
        }
    });
}

// Funci칩n para activar desde el panel (esto enviar칤a un comando al servidor)
function activarChoferManual(tel) {
    const confirmacion = confirm(`쮺onfirmas activaci칩n manual para ${tel}?`);
    if(confirmacion) {
        alert("Activado. El chofer ya puede recibir viajes.");
    }
}

// Actualizar cada 5 segundos
setInterval(actualizarPanel, 5000);
actualizarPanel();

</script>
</body>
</html>
