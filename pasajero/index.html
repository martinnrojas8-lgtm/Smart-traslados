<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Smart Traslados – Pasajero</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body{margin:0;font-family:Arial,sans-serif;background:#f2f2f2;}
  header{background:#000;color:#fff;padding:15px;text-align:center;}
  .screen{padding:20px;}
  button{padding:12px;width:100%;margin-top:10px;border:none;border-radius:6px;background:#00c853;color:#000;font-weight:bold;cursor:pointer;}
  .card{background:#fff;border-radius:10px;padding:15px;margin-top:15px;box-shadow:0 2px 5px rgba(0,0,0,.2);}
  #map{width:100%;height:300px;border-radius:10px;margin-top:10px;background:#ddd;display:flex;align-items:center;justify-content:center;}
</style>
</head>
<body>

<header>
  <h2>Pasajero</h2>
  <div id="userInfo">Verificando...</div>
</header>

<div class="screen">
  <div class="card">
    <h3>Solicitar viaje</h3>
    <div id="map">Cargando mapa…</div>
    <button onclick="pedirViaje()">Pedir viaje</button>
  </div>
  <button style="background:#ff5252;color:#fff;" onclick="cerrarSesion()">Cerrar sesión</button>
</div>

<script>
/* ===== PRUEBA DE DIAGNÓSTICO ===== */
const rawData = localStorage.getItem("sesion");
console.log("Datos crudos en storage:", rawData);

if (!rawData) {
    alert("ERROR: No se encontró ninguna sesión en el almacenamiento. Volviendo al login.");
    location.href = "/";
} else {
    const sesion = JSON.parse(rawData);
    
    if (sesion.rol !== "pasajero") {
        alert("ERROR: Tu rol es '" + sesion.rol + "' y no 'pasajero'. Volviendo al login.");
        location.href = "/";
    } else {
        // SI TODO ESTÁ BIEN
        document.getElementById("userInfo").innerText = "Tel: " + sesion.telefono;
    }
}

/* ===== FUNCIONES DEL MAPA Y VIAJE (Se mantienen igual) ===== */
let map, marker, userLat, userLng;
function initMap(){
  if(!navigator.geolocation) return;
  navigator.geolocation.getCurrentPosition(pos=>{
      userLat = pos.coords.latitude;
      userLng = pos.coords.longitude;
      map = new google.maps.Map(document.getElementById("map"),{center:{lat:userLat,lng:userLng},zoom:15});
      marker = new google.maps.Marker({position:{lat:userLat,lng:userLng},map,title:"Tu ubicación"});
  });
}
function pedirViaje(){ alert("Buscando chofer..."); }
function cerrarSesion(){ localStorage.removeItem("sesion"); location.href = "/"; }
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCeXV1ZmTBpGBIE6MwG8HvIAXziKUPK1d8&callback=initMap" async defer></script>
</body>
</html>
